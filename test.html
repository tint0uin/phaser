<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 3</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            width: 50%;
            margin-left: auto;
            margin-right: auto;
            margin-top: 10em;
            margin-bottom: auto;
        }
    </style>
</head>
<body>

    <script type="text/javascript">

        var config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };
    
        var game = new Phaser.Game(config);

        var isClicking = false;
        var swipeDirection;
        var canTurn = false;
        var distance;



    function preload ()
    {
        this.load.image('sea' , 'assets/sea.png')
        this.load.image('player', 'assets/boat.png');
        this.load.image('enemie', 'assets/enemie_boat.png');
        
    }

    function create ()
    {
        this.add.image(400, 300, 'sea');
        player = this.add.sprite(400,300 , 'player');
        enemie = this.add.sprite(200, 200, 'enemie');

    }

    function update ()
    {
        if(!this.input.activePointer.isDown && isClicking == true) {
            player.setData("positionY", this.input.activePointer.position.y);
            player.setData("positionX", this.input.activePointer.position.x);
            isClicking = false;
            canTurn = true;
            distance = Phaser.Math.Distance.Between(player.x, player.y, player.getData("positionX"),player.getData("positionY"));
        } else if(this.input.activePointer.isDown && isClicking == false) {
            isClicking = true;
        }

        var dy = Math.abs(player.y - player.getData("positionY"));
        var dx = Math.abs(player.x - player.getData("positionX"));

        

        var vx = dx / dy;
        var vy = dy / dx;

       

        if (vx > 1) {
            vx = 1;
        }
         if (vy > 1) {
            vy = 1;
        }

        if(dy <= 6) {
            player.y = player.getData("positionY");
            
        } else if(player.y < player.getData("positionY")) {
            player.y += 5 * vy;
        } else if(player.y > player.getData("positionY")) {
            player.y -= 5 * vy;
        }

        if(dx <= 6) {
            player.x = player.getData("positionX");
            
        } else if(player.x < player.getData("positionX")) {
            player.x += 5 * vx;
        } else if(player.x > player.getData("positionX")) {
            player.x -= 5* vx;
        }

        if (dx <= 6 && dy <= 6) {
            canTurn = false;
        }
        
        if (canTurn) {
            var angle =  Phaser.Math.Angle.Between(player.x, player.y, player.getData("positionX"),  player.getData("positionY"));
            var angleD = Phaser.Math.RAD_TO_DEG * angle;
            player.setAngle(angleD + 90);
            canTurn = false;
        }

        //if (player.body.touching.up && en)
        

        
    }

</script>

</body>
</html>    