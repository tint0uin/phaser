<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 3</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            width: 50%;
            margin-left: auto;
            margin-right: auto;
            margin-top: 10em;
            margin-bottom: auto;
        }
    </style>
</head>
<body>

    <script type="text/javascript">

        var config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            physics: {
                default: 'arcade',
            arcade: {
                debug: true
            }
    },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };
    
        var game = new Phaser.Game(config);

        var isClicking = false;
        var swipeDirection;
        var canTurn = false;
        var distance;
        var minDistance = 7;



    function preload ()
    {
        this.load.image('sea' , 'assets/sea.png')
        this.load.image('player', 'assets/boat.png');
        this.load.image('enemie', 'assets/enemie_boat.png');
        this.load.image('vois', 'assets.void.png');

        
        
    }

    function create ()
    {
        this.add.image(400, 300, 'sea');
        player = this.physics.add.sprite(400,300 , 'player');
        player.body.setSize(90 ,90);

        this.cameras.main.startFollow(player);
        //this.cameras.main.setZoom(2);

        playerF = this.physics.add.sprite(400, 240, 'void');
        playerF.visible = false;

        
        s1 = this.physics.add.image();
        s1.body.setCircle(10);


        enemies = this.physics.add.sprite(200, 200, 'enemie');

        
        
        this.physics.add.collider(player, enemies);
        this.physics.add.collider(s1, enemies);

        

        this.events.on("postupdate", function () {
            Phaser.Display.Align.To.TopCenter(playerF, player);
        });
        
        

    }

    function update ()
    {
        if(!this.input.activePointer.isDown && isClicking == true) {
            player.setData("positionY", this.input.activePointer.position.y);
            player.setData("positionX", this.input.activePointer.position.x);
            isClicking = false;
            canTurn = true;
            distance = Phaser.Math.Distance.Between(player.x, player.y, player.getData("positionX"),player.getData("positionY"));
        } else if(this.input.activePointer.isDown && isClicking == false) {
            isClicking = true;
        }

        var dy = Math.abs(player.y - player.getData("positionY"));
        var dx = Math.abs(player.x - player.getData("positionX"));

        

        var vx = dx / dy;
        var vy = dy / dx;

       

        if (vx > 1) {
            vx = 1;
        }
         if (vy > 1) {
            vy = 1;
        }

        if(dx <= minDistance) {
            player.setVelocityX(0);  
        } else if(player.x < player.getData("positionX")) {
            player.setVelocityX(400 * vx); 
        } else if(player.x > player.getData("positionX")) {
           player.setVelocityX(-400 * vx);
        }

        if(dy <= minDistance) {
            player.setVelocityY(0);  
            
            
        } else if(player.y < player.getData("positionY")) {
            player.setVelocityY(400 * vy);
            
        } else if(player.y > player.getData("positionY")) {
           player.setVelocityY(-400 * vy);
           
        }

        
        
        

        if (dx <= minDistance && dy <= minDistance) {
            canTurn = false;
        }
        
        if (canTurn) {
            //player.setAngularVelocity(-120);
            //var angle =  Phaser.Math.Angle.Between(player.x, player.y, player.getData("positionX"),  player.getData("positionY"));
            //var angleD = Phaser.Math.RAD_TO_DEG * angle;
            //player.setAngle(angleD + 90);
            //player.setAngularVelocity(angleD + 90);
            //player.setAngularVelocity(0);
            //this.physics.velocityFromRotation(ship.rotation, 600, ship.body.acceleration);
            
            canTurn = false;
        }

        

        if (playerF.body.touching && (enemies.body.touching.left || enemies.body.touching.right)) {
            console.log("win");
        }

        centerBodyOnXY(s1.body, player.body.x + 25, player.body.y + 10);

        player.body.updateCenter();
        s1.body.updateCenter();
        //RotateAround(s1.body.center, player.body.center.x, player.body.center.y, player.rotation);
        

        
    }
    function centerBodyOnBody (a, b) {
        a.position.set(
            b.x + b.halfWidth - a.halfWidth,
            b.y + b.halfHeight - a.halfHeight
        );
        }

    function centerBodyOnPoint (a, p) {
        centerBodyOnXY(a, p.x, p.y);
    }

    function centerBodyOnXY (a, x, y) {
        a.position.set(
            x - a.halfWidth,
            y - a.halfHeight
        );
    }


</script>

</body>
</html>    