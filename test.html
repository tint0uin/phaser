<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 3</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            width: 50%;
            margin-left: auto;
            margin-right: auto;
            margin-top: 10em;
            margin-bottom: auto;
        }
    </style>
</head>
<body>

    <script type="text/javascript">

        var config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            physics: {
                default: 'arcade',
            arcade: {
            
            }
    },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };
    
        var game = new Phaser.Game(config);

        var isClicking = false;
        var swipeDirection;
        var canTurn = false;
        var distance;
        var minDistance = 9;



    function preload ()
    {
        this.load.image('sea' , 'assets/sea.png')
        this.load.image('player', 'assets/boat.png');
        this.load.image('enemie', 'assets/enemie_boat.png');

        
        
    }

    function create ()
    {
        this.add.image(400, 300, 'sea');
        player = this.physics.add.sprite(400,300 , 'player');
        enemie = this.physics.add.sprite(200, 200, 'enemie');
        
        

    }

    function update ()
    {
        if(!this.input.activePointer.isDown && isClicking == true) {
            player.setData("positionY", this.input.activePointer.position.y);
            player.setData("positionX", this.input.activePointer.position.x);
            isClicking = false;
            canTurn = true;
            distance = Phaser.Math.Distance.Between(player.x, player.y, player.getData("positionX"),player.getData("positionY"));
        } else if(this.input.activePointer.isDown && isClicking == false) {
            isClicking = true;
        }

        var dy = Math.abs(player.y - player.getData("positionY"));
        var dx = Math.abs(player.x - player.getData("positionX"));

        

        var vx = dx / dy;
        var vy = dy / dx;

       

        if (vx > 1) {
            vx = 1;
        }
         if (vy > 1) {
            vy = 1;
        }

        if(dx <= minDistance) {
            player.x = player.getData("positionX");
            if(dy <= minDistance) {
                player.y = player.getData("positionY");
                
            } else if(player.y < player.getData("positionY")) {
                player.setVelocity(0 , 500 * vy).normalize;
                
            } else if(player.y > player.getData("positionY")) {
                player.setVelocity(0 , -500 * vy);
            }
            
        } else if(player.x < player.getData("positionX")) {
            if(dy <= minDistance) {
                player.y = player.getData("positionY");
                player.setVelocity(500 * vx , 0);
                
            } else if(player.y < player.getData("positionY")) {
                player.setVelocity(500 * vx , 500 * vy);
                
            } else if(player.y > player.getData("positionY")) {
                player.setVelocity(500 * vx , -500 * vy);
            }
            
        } else if(player.x > player.getData("positionX")) {
            if(dy <= minDistance) {
                player.y = player.getData("positionY");
                player.setVelocity(-500 * vx , 0);
                
            } else if(player.y < player.getData("positionY")) {
                player.setVelocity(-500 * vx , 500 * vy);
                
            } else if(player.y > player.getData("positionY")) {
                player.setVelocity(-500 * vx , -500 * vy);
            }
            
        }

        

        

        if (dx <= minDistance && dy <= minDistance) {
            canTurn = false;
        }
        
        if (canTurn) {
            var angle =  Phaser.Math.Angle.Between(player.x, player.y, player.getData("positionX"),  player.getData("positionY"));
            var angleD = Phaser.Math.RAD_TO_DEG * angle;
            player.setAngle(angleD + 90);
            canTurn = false;
        }

        if (!player.body.touching.none) {
            console.log(player.x);
        }

        if (player.body.touching.right && (enemie.body.touching.left || enemie.body.touching.right)) {
            console.log("win");
        }
        

        
    }

</script>

</body>
</html>    